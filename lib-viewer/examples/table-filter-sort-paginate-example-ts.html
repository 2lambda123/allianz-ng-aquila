<span class="hljs-keyword">import</span> { Component, Injectable } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> { SortEvent, SortDirection, NxSortHeaderIntl } <span class="hljs-keyword">from</span> <span class="hljs-string">'@aposin/ng-aquila/table'</span>;

<span class="hljs-keyword">interface</span> Contract {
  product: <span class="hljs-built_in">string</span>;
  contractNumber: <span class="hljs-built_in">number</span>;
  desc: <span class="hljs-built_in">string</span>;
  website: <span class="hljs-built_in">string</span>;
  endingAt: <span class="hljs-built_in">Date</span>;
  status: <span class="hljs-built_in">string</span>;
  statusText: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> MyIntl <span class="hljs-keyword">extends</span> NxSortHeaderIntl {
  sortAscendingAriaLabel = <span class="hljs-string">'sort ascending by'</span>;
  sortDescendingAriaLabel = <span class="hljs-string">'sort descending by'</span>;
}

<span class="hljs-comment">/**
* @title Advanced example for sorting, filtering and pagination
*/</span>
<span class="hljs-meta">@Component</span>({
  styleUrls: [<span class="hljs-string">'table-filter-sort-paginate-example.css'</span>],
  templateUrl: <span class="hljs-string">'./table-filter-sort-paginate-example.html'</span>,
  providers: [
    { provide: NxSortHeaderIntl, useClass: MyIntl },
  ],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> TableFilterSortPaginateExampleComponent {
  tableElements: Contract[] = [
    {
      product: <span class="hljs-string">'Car'</span>,
      contractNumber: <span class="hljs-number">1234</span>,
      desc: <span class="hljs-string">'this is a contract'</span>,
      website: <span class="hljs-string">'www.example.com'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'1/3/2020'</span>),
      status: <span class="hljs-string">'negative'</span>,
      statusText: <span class="hljs-string">'open'</span>
    },
    {
      product: <span class="hljs-string">'AA'</span>,
      contractNumber: <span class="hljs-number">334</span>,
      desc: <span class="hljs-string">'this is a contract'</span>,
      website: <span class="hljs-string">'www.aposin.org'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'1/3/2019'</span>),
      status: <span class="hljs-string">'negative'</span>,
      statusText: <span class="hljs-string">'open'</span>
    },
    {
      product: <span class="hljs-string">'BB'</span>,
      contractNumber: <span class="hljs-number">6643</span>,
      desc: <span class="hljs-string">'this is a contract'</span>,
      website: <span class="hljs-string">'www.example.com'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'1/3/2020'</span>),
      status: <span class="hljs-string">'negative'</span>,
      statusText: <span class="hljs-string">'open'</span>
    },
    {
      product: <span class="hljs-string">'DD'</span>,
      contractNumber: <span class="hljs-number">1288</span>,
      desc: <span class="hljs-string">'this is a contract'</span>,
      website: <span class="hljs-string">'www.example.com'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'1/12/2018'</span>),
      status: <span class="hljs-string">'negative'</span>,
      statusText: <span class="hljs-string">'open'</span>
    },
    {
      product: <span class="hljs-string">'DDE'</span>,
      contractNumber: <span class="hljs-number">1456</span>,
      desc: <span class="hljs-string">'this is a contract'</span>,
      website: <span class="hljs-string">'www.example.com'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'1/11/2020'</span>),
      status: <span class="hljs-string">'negative'</span>,
      statusText: <span class="hljs-string">'open'</span>
    },
    {
      product: <span class="hljs-string">'GG'</span>,
      contractNumber: <span class="hljs-number">122</span>,
      desc: <span class="hljs-string">'this is a contract'</span>,
      website: <span class="hljs-string">'www.example.org'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'12/6/2020'</span>),
      status: <span class="hljs-string">'negative'</span>,
      statusText: <span class="hljs-string">'open'</span>
    },
    {
      product: <span class="hljs-string">'JK'</span>,
      contractNumber: <span class="hljs-number">1422</span>,
      desc: <span class="hljs-string">'this is a contract'</span>,
      website: <span class="hljs-string">'www.aposin.org'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'1/3/2020'</span>),
      status: <span class="hljs-string">'negative'</span>,
      statusText: <span class="hljs-string">'open'</span>
    },
    {
      product: <span class="hljs-string">'M'</span>,
      contractNumber: <span class="hljs-number">1225</span>,
      desc: <span class="hljs-string">'this is a contract'</span>,
      website: <span class="hljs-string">'www.example.org'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'4/5/2020'</span>),
      status: <span class="hljs-string">'negative'</span>,
      statusText: <span class="hljs-string">'open'</span>
    },
    {
      product: <span class="hljs-string">'L'</span>,
      contractNumber: <span class="hljs-number">1313</span>,
      desc: <span class="hljs-string">'this is a contract'</span>,
      website: <span class="hljs-string">'www.aposin.org'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'1/4/2020'</span>),
      status: <span class="hljs-string">'negative'</span>,
      statusText: <span class="hljs-string">'open'</span>
    },
    {
      product: <span class="hljs-string">'Legal'</span>,
      contractNumber: <span class="hljs-number">2423</span>,
      desc: <span class="hljs-string">'this is another contract'</span>,
      website: <span class="hljs-string">'www.aposin.org'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'4/2/2020'</span>),
      status: <span class="hljs-string">'active'</span>,
      statusText: <span class="hljs-string">'processing'</span>
    },
    {
      product: <span class="hljs-string">'CC'</span>,
      contractNumber: <span class="hljs-number">4356</span>,
      desc: <span class="hljs-string">'this is a contract'</span>,
      website: <span class="hljs-string">'www.example.com'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'1/9/2020'</span>),
      status: <span class="hljs-string">'negative'</span>,
      statusText: <span class="hljs-string">'open'</span>
    },
    {
      product: <span class="hljs-string">'Health'</span>,
      contractNumber: <span class="hljs-number">353455</span>,
      desc: <span class="hljs-string">'Lorem ipsum dolor sit amet, csis libero. '</span>,
      website: <span class="hljs-string">'www.aposin.org'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'6/2/2017'</span>),
      status: <span class="hljs-string">'positive'</span>,
      statusText: <span class="hljs-string">'accepted'</span>
    },
    {
      product: <span class="hljs-string">'Car'</span>,
      contractNumber: <span class="hljs-number">22344</span>,
      desc: <span class="hljs-string">'this is a description of a contract'</span>,
      website: <span class="hljs-string">'www.example.com'</span>,
      endingAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'1/20/2027'</span>),
      status: <span class="hljs-string">'critical'</span>,
      statusText: <span class="hljs-string">'rejected'</span>
    }
  ];

  currentlyShownPageElements: Contract[];
  currentlyAvailableElements: Contract[];

  page: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;
  filterValue: <span class="hljs-built_in">string</span>;
  elementsPerPage: <span class="hljs-built_in">number</span> = <span class="hljs-number">5</span>;

  <span class="hljs-comment">/**
   * Sorts the table data by a certain category.
   */</span>
  sortTable(sort: SortEvent) {
    <span class="hljs-keyword">this</span>.currentlyAvailableElements = <span class="hljs-keyword">this</span>.currentlyAvailableElements.sort(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (sort.active <span class="hljs-keyword">in</span> a &amp;&amp; sort.active <span class="hljs-keyword">in</span> b) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.compare(a[sort.active], b[sort.active], sort.direction);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    });

    <span class="hljs-keyword">this</span>.updatePage();
  }

  compare(
    a: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-built_in">Date</span>,
    b: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-built_in">Date</span>,
    direction: SortDirection) {

    <span class="hljs-keyword">return</span> (a &lt; b ? <span class="hljs-number">-1</span> : <span class="hljs-number">1</span>) * (direction === <span class="hljs-string">'asc'</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">-1</span>);
  }

  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">this</span>.currentlyAvailableElements = <span class="hljs-keyword">this</span>.tableElements;
    <span class="hljs-comment">// init first page on page load</span>
    <span class="hljs-keyword">this</span>.updatePage();
  }

  onFilterValueChange(value) {
    <span class="hljs-keyword">this</span>.filterData(value);
  }

  filterData(filterValue: <span class="hljs-built_in">string</span>) {
    <span class="hljs-keyword">this</span>.currentlyAvailableElements = <span class="hljs-keyword">this</span>.tableElements.filter(<span class="hljs-function"><span class="hljs-params">tableRowObject</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.values(tableRowObject).some(<span class="hljs-function"><span class="hljs-params">propertyValue</span> =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(filterValue, <span class="hljs-string">'i'</span>).test(<span class="hljs-built_in">String</span>(propertyValue)));
    });

    <span class="hljs-keyword">this</span>.updatePage();
  }

  updatePage() {
    <span class="hljs-keyword">const</span> indexMin = (<span class="hljs-keyword">this</span>.page - <span class="hljs-number">1</span>) * <span class="hljs-keyword">this</span>.elementsPerPage;
    <span class="hljs-keyword">const</span> indexMax = indexMin + <span class="hljs-keyword">this</span>.elementsPerPage;
    <span class="hljs-keyword">this</span>.currentlyShownPageElements = <span class="hljs-keyword">this</span>.currentlyAvailableElements.filter(
      <span class="hljs-function">(<span class="hljs-params">x, index</span>) =&gt;</span> index &gt;= indexMin &amp;&amp; index &lt; indexMax
    );
  }

  prevPage() {
    <span class="hljs-keyword">this</span>.page--;
    <span class="hljs-keyword">this</span>.updatePage();
  }

  nextPage() {
    <span class="hljs-keyword">this</span>.page++;
    <span class="hljs-keyword">this</span>.updatePage();
  }

  goToPage(n: <span class="hljs-built_in">number</span>) {
    <span class="hljs-keyword">this</span>.page = n;
    <span class="hljs-keyword">this</span>.updatePage();
  }
}
